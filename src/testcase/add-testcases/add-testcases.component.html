<div class="container-fluid">
  <!-- Module Selection -->
  <div class="selection-row">
    <label class="mr-05">Select Module</label>
    <select [ngModel]="selectedModule()" (ngModelChange)="onModuleChange($event)">
      <option value="">-- Choose Module --</option>
      <option *ngFor="let m of modules" [value]="m.id">{{ m.name }}</option>
    </select>
    <button class="btn-small primary ml-05" (click)="toggleAddModule()">➕ Add Module</button>
    <button *ngIf="selectedModule()" class="btn-small export ml-auto" (click)="exportModuleToExcel()">📤 Export</button>
  </div>

  <!-- Add Module Form -->
  <div class="form-box" *ngIf="showAddModuleForm">
    <div class="form-group">
      <label>Module Name</label>
      <input [(ngModel)]="newModuleName" />
    </div>
    <div class="form-group">
      <label>Initial Version</label>
      <input [(ngModel)]="newModuleVersion" />
    </div>
    <div class="form-group">
      <button class="btn-small success mr-05" (click)="saveModule()">✅ Save</button>
      <button class="btn-small danger" (click)="cancelAddModule()">❌ Cancel</button>
    </div>
  </div>

  <!-- Version Selection -->
  <div class="selection-row" *ngIf="selectedModule()">
    <label class="mr-05">Select Version</label>
    <select [ngModel]="selectedVersion()" (ngModelChange)="onVersionChange($event)">
      <option value="">-- Choose Version --</option>
      <option *ngFor="let v of versions()" [value]="v">{{ v }}</option>
    </select>
    <button class="btn-small primary ml-05" (click)="toggleAddVersionForm()">➕ Add Version</button>
  </div>

  <!-- Add Version Form -->
  <div class="form-box" *ngIf="showAddVersionForm">
    <div class="form-group">
      <input [(ngModel)]="newVersionName" placeholder="New version (e.g. v1.2)" />
    </div>
    <div class="form-group">
      <button class="btn-small success mr-05" (click)="addNewVersion()">✅ Save Version</button>
      <button class="btn-small danger" (click)="cancelAddVersionForm()">❌ Cancel</button>
    </div>
  </div>

  <!-- Action Buttons -->
  <div class="selection-row" *ngIf="selectedModule() && selectedVersion()">
    <button class="btn-small success mr-05" (click)="openTestCaseForm()">➕ Add Test Case</button>
    <button
  class="btn-small warning"[routerLink]="['/tester/edit-testcases', selectedModule(), selectedVersion()]"[disabled]="!selectedModule() || !selectedVersion()">
  ✏️ Edit Test Cases
</button>

  </div>

  <!-- Edit Search -->
  <div *ngIf="showEditSearch" class="form-box">
    <label>Search by SlNo / TestCase ID / Use Case</label>
    <input type="text" [ngModel]="searchQuery()" (ngModelChange)="searchQuery.set($event)" placeholder="e.g. 1 or TC101 or Login" />
    <div *ngIf="filteredResults().length === 0 && searchQuery()">
      <p style="color:red;">❌ No match found.</p>
    </div>
    <div *ngFor="let tc of filteredResults()" class="form-box">
      <strong>#{{ tc.slNo }}</strong> – {{ tc.fixed.testCaseId }} <br />
      <em>{{ tc.fixed.useCase }}</em>
      <button class="btn-small primary ml-05" (click)="editTestCase(tc)">✏️ Edit</button>
      <button class="btn-small danger ml-05" (click)="deleteTestCase(tc)">🗑️ Delete</button>
    </div>
  </div>

  <!-- Test Case Form -->
  <form *ngIf="showForm" [formGroup]="form" (ngSubmit)="onSubmit()" class="form-box">
    <table class="form-table">
      <thead>
        <tr>
          <th>Use Case</th>
          <th>Test Case ID</th>
          <th>Scenario</th>
          <th>Steps</th>
          <th>Expected</th>
          <th *ngFor="let attr of savedDynamicAttributes">{{ attr.key }}</th>
          <th *ngIf="dynamic.controls.length > 0">New Attribute</th>
        </tr>
      </thead>

      <tbody>
        <tr [formGroup]="fixed">
          <td><input formControlName="useCase" required /></td>
          <td><input formControlName="testCaseId" required /></td>
          <td><textarea formControlName="scenario" required></textarea></td>
          <td><textarea formControlName="steps" required></textarea></td>
          <td><textarea formControlName="expected" required></textarea></td>

          <!-- Saved Dynamic Attributes -->
          <td *ngFor="let attr of savedDynamicAttributes; let i = index">
            <textarea
              [(ngModel)]="attr.value"
              [ngModelOptions]="{ standalone: true }"
            ></textarea>
            <button type="button" class="btn-small danger" (click)="removeSavedAttribute(i)">❌ Remove</button>
          </td>

          <!-- Input Row for New Attribute -->
        <td *ngIf="dynamic.controls.length > 0" [formGroup]="dynamicFirstGroup">
  <input formControlName="key" placeholder="Attribute name" required />
  <textarea formControlName="value" placeholder="Attribute value" required></textarea>
  <div class="form-group">
    <button type="button" class="btn-small success mr-05" (click)="saveDynamicAttribute()">💾 Save</button>
    <button type="button" class="btn-small danger" (click)="cancelDynamicAttribute()">❌ Cancel</button>
  </div>
</td>
        </tr>
      </tbody>
    </table>

    <div class="form-group">
      <button type="button" class="btn-small primary" (click)="addDynamicField()" *ngIf="dynamic.controls.length === 0">
        ➕ Add Attribute
      </button>
      <button type="submit" class="btn-small success mr-05">✅ Save Test Case</button>
      <button type="button" class="btn-small danger ml-05" (click)="closeTestCaseForm()">❌ Cancel</button>
    </div>
  </form>
</div>
