<div class="container">
  <h2 class="header">‚ú® Module Management</h2>

  <!-- Product Selection First -->
  <div class="product-selector">
    <label for="productSelect"> üì¶Select Product</label>
    <select id="productSelect" [(ngModel)]="selectedProductId" class="form-select">
      <option value="" disabled selected>-- Choose Product --</option>
      <option *ngFor="let product of products" [value]="product.id">{{ product.name }}</option>
    </select>
  </div>

  <!-- Show Actions Only After Product Selected -->
  <ng-container *ngIf="selectedProductId">
    <!-- Main Action Buttons -->
    <div class="action-buttons">
      <button class="btn btn-modules" (click)="toggleModulesList()">
        <span class="icon">üì¶</span> Modules
      </button>
      <button class="btn btn-primary" (click)="showAddModuleForm = true">
        <span class="icon">‚ûï</span> Add Module
      </button>
      <button class="btn btn-info" (click)="initAddVersion()">
        <span class="icon">üîñ</span> Add Version
      </button>
    </div>

    <!-- Modules List -->
    <div *ngIf="showModulesList" class="modules-list-section">
      <div class="section-header">
        <h3>All Modules</h3>
        <button class="btn btn-close" (click)="showModulesList = false">‚úï</button>
      </div>

      <div *ngIf="modules().length === 0" class="empty-state">
        No modules available. Add a module first.
      </div>

      <div *ngFor="let module of modules()" class="module-item">
        <div class="module-info">
          <div *ngIf="!module.editing" class="module-name">{{ module.name }}</div>
          <input *ngIf="module.editing" [(ngModel)]="module.name" class="edit-input">

          <div class="module-versions">
            <span>Versions: </span>
            <span *ngIf="!(versionsByModule()[module.id]?.length)">None</span>
            <span *ngFor="let version of versionsByModule()[module.id]" class="version-badge">
              {{ version }}
            </span>
          </div>
        </div>

        <div class="module-actions">
          <button *ngIf="!module.editing" class="btn btn-warning" (click)="startEditing(module)">
            <span class="icon">‚úèÔ∏è</span> Edit
          </button>
          <button *ngIf="module.editing" class="btn btn-success" (click)="saveEditing(module)">
            <span class="icon">üíæ</span> Save
          </button>
          <button class="btn btn-danger" (click)="deleteModule(module.id)">
            <span class="icon">üóëÔ∏è</span> Delete
          </button>
        </div>
      </div>
    </div>

    <!-- Add Module Form -->
    <div *ngIf="showAddModuleForm" class="form-overlay">
      <div class="form-box">
        <h3>Add New Module</h3>
        <div class="form-group">
          <label>Module Name</label>
          <input [(ngModel)]="newModuleName" placeholder="e.g. Payment Module" />
        </div>
        <div class="form-group">
          <label>Initial Version</label>
          <input [(ngModel)]="newModuleVersion" placeholder="v1.0" />
        </div>
        <div class="form-actions">
          <button class="btn btn-success" (click)="saveModule()">
            <span class="icon">‚úÖ</span> Save Module
          </button>
          <button class="btn btn-secondary" (click)="showAddModuleForm = false">Cancel</button>
        </div>
      </div>
    </div>

    <!-- Add Version Form -->
    <div *ngIf="showAddVersionForm" class="form-overlay">
      <div class="form-box">
        <h3>Add New Version</h3>
        <div class="form-group">
          <label>Select Module</label>
          <select [(ngModel)]="selectedModuleId" class="form-select">
            <option value="" disabled selected>Select a module</option>
            <option *ngFor="let mod of modules()" [value]="mod.id">{{ mod.name }}</option>
          </select>
        </div>
        <div class="form-group">
          <label>New Version</label>
          <input [(ngModel)]="newVersionName" placeholder="e.g. v1.2" />
        </div>
        <div class="form-actions">
          <button class="btn btn-success" (click)="saveVersion()">
            <span class="icon">‚úÖ</span> Save Version
          </button>
          <button class="btn btn-secondary" (click)="showAddVersionForm = false">Cancel</button>
        </div>
      </div>
    </div>
  </ng-container>
</div>
